[mysqld]

# ===============================
# MEMORY (4GB container optimized)
# ===============================


innodb_log_file_size = 1G
innodb_log_buffer_size = 256M
innodb_flush_log_at_trx_commit = 2

# Use ~75% of memory for buffer pool
innodb_buffer_pool_size = 3G
innodb_buffer_pool_instances = 4

# Log buffer does NOT need to be huge
# innodb_log_buffer_size = 128M

# Modern MySQL 8 redo configuration
innodb_redo_log_capacity = 2G

# ===============================
# WRITE OPTIMIZATION (bulk load mode)
# ===============================

# Max performance (unsafe if crash)
innodb_flush_log_at_trx_commit = 0
sync_binlog = 0

# NVMe friendly
innodb_flush_method = O_DIRECT
innodb_flush_neighbors = 0

# Increase background flush power
innodb_io_capacity = 3000
innodb_io_capacity_max = 6000

# Reduce flush spikes
innodb_lru_scan_depth = 2048

# ===============================
# THREADING (2 CPU container)
# ===============================

innodb_read_io_threads = 8
innodb_write_io_threads = 8

# Prevent too much thread contention
innodb_thread_concurrency = 0

# ===============================
# CONNECTIONS
# ===============================

max_connections = 150
skip_name_resolve = ON

# ===============================
# TEMP / SORT
# ===============================

tmp_table_size = 256M
max_heap_table_size = 256M

# ===============================
# TABLE CACHE
# ===============================

table_open_cache = 4000
table_definition_cache = 2000

# ===============================
# STATS & OVERHEAD REDUCTION
# ===============================

performance_schema = OFF
innodb_stats_on_metadata = 0

# ===============================
# SQL MODE
# ===============================

sql_mode = STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION

default_authentication_plugin = mysql_native_password
